window.fn = {};

window.fn.open = function () {

    var menu = document.getElementById('menu');
    menu.open();
};

window.fn.load = function (page) {
    var content = document.getElementById('content');
    var menu = document.getElementById('menu');
    content.load(page)
        .then(menu.close.bind(menu));
};


document.addEventListener('init', function (event) {

    if (event.target.id == "home") {
        openDb();
        getItems();
    }
    if (event.target.id == "cadastro") {
        horario();

    }

});



var db = null;

function onError(tx, e) {

    alert("algo errado " + e.message);
}

function onSucess(tx, r) {

    getItems();
}


function openDb() {



    db = openDatabase("lembre_me", "1", "lembre_me list", 1024 * 1024);

    db.transaction(function (tx) {
        tx.executeSql("CREATE TABLE IF NOT EXISTS despertador (ID INTEGER PRIMARY KEY ASC,descricao TEXT, horario text)", []);
    });


}


function getItems() {

    db.transaction(function (tx) {
        tx.executeSql("SELECT * FROM despertador", [], renderItems, onError);

    });

}

function renderItems(tx, rs) {

    var output = "";
    var list = document.getElementById("lista");


    for (i = 0; i < rs.rows.length; i++) {
        var row = rs.rows.item(i);
        output += "<ons-list-item>" + row.descricao + ', ' + row.horario +
            "<div class=\"rigth\"><ons-button onclick='deleteItem(" + row.ID + ");'><ons-icon icon=\"trash\"></ons-icon></ons-button><ons-button onclick='editItem(" + row.ID + ");'><ons-icon icon=\"pencil\"></ons-icon></ons-button></div>" +
            "</ons-list-item>";
    }

    list.innerHTML = output;

}


function addItem(descricao, horario) {
    var textbox = document.getElementById("descricao");
    var value1 = textbox.value;
    var textbox2 = document.getElementById("horario");
    var value2 = textbox2.value;
    db.transaction(function (tx) {
        tx.executeSql("INSERT INTO  despertador (descricao,horario) VALUES (?,?)", [value1, value2], onSucess, onError);

    });

    textbox.value = "";
    fn.load("home.html");

}



function deleteItem(id) {

    db.transaction(function (tx) {
        tx.executeSql("DELETE FROM despertador WHERE id= ?", [id], onSucess, onError);

    });
}

function editItem(id) {
    alert('id = ' + id);
    //db.transaction(function (tx) {
    //  tx.executeSql("DELETE FROM items WHERE id= ?",[id],onSucess,onError);
    // });

}

function horario() {
    var data = new Date();
    var horaAtual = data.getHours();
    var minutoAtual = data.getMinutes();
    var montaMinuto = '';
    var montaHora = '';

    montaHora += ' hora: <br> <ons-select  onchange="editSelects(event)">';
    for (var j = 1; j < 25; j++) {


        if (j == horaAtual) {
            montaHora += '<option value="' + j + '" selected >' + j + '</option>';
        } else {
            montaHora += '<option value="' + j + '" >' + j + '</option>';
        }

    }
    montaHora += '</ons-select>';
    var hora = document.getElementById('hora');
    hora.innerHTML = montaHora;


    montaMinuto += 'minuto: <br><ons-select  onchange="editSelects(event)">';
    for (var i = 0; i < 60; i++) {

        if (i == minutoAtual) {
            montaMinuto += '<option value="' + i + '"  selected>' + i + '</option>';
        } else {

            montaMinuto += '<option value="' + i + '" >' + i + '</option>';
        }
    }
    montaMinuto += '</ons-select>';
    var minuto = document.getElementById('minuto');
    minuto.innerHTML = montaMinuto;

}